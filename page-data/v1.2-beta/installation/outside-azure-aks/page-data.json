{"componentChunkName":"component---node-modules-gatsby-theme-apollo-docs-src-components-template-js","path":"/v1.2-beta/installation/outside-azure-aks/","result":{"data":{"site":{"pathPrefix":"","siteMetadata":{"title":"akv2k8s docs","description":"How to get Azure Key Vault objects into Kubernetes"}},"file":{"childMarkdownRemark":{"frontmatter":{"title":"Installing outside Azure AKS","description":"Learn how to install Azure Key Vault to Kubernetes outside Azure AKS"},"headings":[{"value":"About Custom Resource Definitions"},{"value":"Installation"}],"fields":{"image":"social-cards/outside-azure-aks.png","graphManagerUrl":""},"htmlAst":{"type":"root","children":[{"type":"element","tagName":"blockquote","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Make sure to check the "},{"type":"element","tagName":"a","properties":{"href":"/v1.2-beta/installation/requirements/"},"children":[{"type":"text","value":"requirements"}]},{"type":"text","value":" before installing."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{"id":"about-custom-resource-definitions","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#about-custom-resource-definitions","ariaLabel":"about custom resource definitions permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"About Custom Resource Definitions"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"On first install, the Helm Chart will add the "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"AzureKeyVaultSecret"}]},{"type":"text","value":" CRD to Kubernetes if it does not already exists. On later upgrades or if it already exists, any changed to the CRD will not be updated by the Helm Chart. This is by design: "},{"type":"element","tagName":"a","properties":{"href":"https://helm.sh/docs/chart_best_practices/custom_resource_definitions/#method-1-let-helm-do-it-for-you"},"children":[{"type":"text","value":"https://helm.sh/docs/chart_best_practices/custom_resource_definitions/#method-1-let-helm-do-it-for-you"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"NOTE: When upgrading Azure Key Vault to Kubernetes, manually apply CRDs before upgrade. Latest CRDs will always be available at "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/sparebankenvest/azure-key-vault-to-kubernetes/crds"},"children":[{"type":"text","value":"https://github.com/sparebankenvest/azure-key-vault-to-kubernetes/crds"}]},{"type":"text","value":" and can be installed manually by:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"style":"counter-reset: linenumber NaN","className":["language-text","line-numbers"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"kubectl apply -f https://raw.githubusercontent.com/sparebankenvest/azure-key-vault-to-kubernetes/master/crds/AzureKeyVaultSecret.yaml"}]},{"type":"element","tagName":"span","properties":{"ariaHidden":"true","className":["line-numbers-rows"],"style":"white-space: normal; width: auto; left: 0;"},"children":[{"type":"element","tagName":"span","properties":{},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"In versions <=1.2 of Akv2k8s only the "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"AzureKeyVaultSecret"}]},{"type":"text","value":" CRD is needed."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"blockquote","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Note: If you delete the "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"AzureKeyVaultSecret"}]},{"type":"text","value":" CRD from Kubernetes, all resources of type "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"AzureKeyVaultSecret"}]},{"type":"text","value":" created in cluster will be removed. This is by design: "},{"type":"element","tagName":"a","properties":{"href":"https://kubernetes.io/docs/tasks/extend-kubernetes/custom-resources/custom-resource-definitions/#delete-a-customresourcedefinition"},"children":[{"type":"text","value":"https://kubernetes.io/docs/tasks/extend-kubernetes/custom-resources/custom-resource-definitions/#delete-a-customresourcedefinition"}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{"id":"installation","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#installation","ariaLabel":"installation permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Installation"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{"id":"create-a-dedicated-namespace","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#create-a-dedicated-namespace","ariaLabel":"create a dedicated namespace permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Create a dedicated namespace"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"A dedicated namespace needs to be created for akv2k8s:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"bash"},"children":[{"type":"element","tagName":"pre","properties":{"style":"counter-reset: linenumber NaN","className":["language-bash","line-numbers"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"text","value":"kubectl create ns akv2k8s"}]},{"type":"element","tagName":"span","properties":{"ariaHidden":"true","className":["line-numbers-rows"],"style":"white-space: normal; width: auto; left: 0;"},"children":[{"type":"element","tagName":"span","properties":{},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"...or provide "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"--create-namespace"}]},{"type":"text","value":" with Helm 3."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{"id":"installing-with-helm-outside-azure-aks","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#installing-with-helm-outside-azure-aks","ariaLabel":"installing with helm outside azure aks permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Installing with Helm outside Azure AKS"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"When running "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"inside"}]},{"type":"text","value":" Azure AKS, Akv2k8s will use the AKS cluster credentials by default to authenticate with Azure Key Vault. "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Outside"}]},{"type":"text","value":" Azure AKS - credentials must be provided by setting "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"env_injector.keyVaultAuth=environment"}]},{"type":"text","value":" and provide credentials as documented under "},{"type":"element","tagName":"a","properties":{"href":"/v1.2-beta/security/authentication/"},"children":[{"type":"text","value":"Authentication"}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Add Helm repository:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"bash"},"children":[{"type":"element","tagName":"pre","properties":{"style":"counter-reset: linenumber NaN","className":["language-bash","line-numbers"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"text","value":"helm repo "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"add"}]},{"type":"text","value":" spv-charts https://charts.spvapi.no\nhelm repo update"}]},{"type":"element","tagName":"span","properties":{"ariaHidden":"true","className":["line-numbers-rows"],"style":"white-space: normal; width: auto; left: 0;"},"children":[{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Example of installing akv2k8s using client-id/secret as Azure Key Vault credentials:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"style":"counter-reset: linenumber NaN","className":["language-text","line-numbers"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"helm upgrade --install akv2k8s spv-charts/akv2k8s \\\n  --namespace akv2k8s \\\n  --set global.keyVaultAuth=environment \\\n  --set global.env.AZURE_TENANT_ID=<tenant-id> \\\n  --set global.env.AZURE_CLIENT_ID=<client-id> \\\n  --set global.env.AZURE_CLIENT_SECRET=<client-secret>"}]},{"type":"element","tagName":"span","properties":{"ariaHidden":"true","className":["line-numbers-rows"],"style":"white-space: normal; width: auto; left: 0;"},"children":[{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]},{"type":"element","tagName":"span","properties":{},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{"id":"legacy-charts","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#legacy-charts","ariaLabel":"legacy charts permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Legacy Charts"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Prior to Akv2k8s version 1.1, two Helm charts existed: "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"azure-key-vault-controller"}]},{"type":"text","value":" and "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"azure-key-vault-env-injector"}]},{"type":"text","value":". These are deprecated in favor of the new "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"akv2k8s"}]},{"type":"text","value":" chart. The old Charts used Helm 2 and the new Chart uses Helm 3. For this reason we still maintain the old charts for version 1.1, but we will not maintain future versions after 1.1. Those will only be available in the "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"akv2k8s"}]},{"type":"text","value":" Chart."}]}],"data":{"quirksMode":false}}},"childMdx":null}},"pageContext":{"id":"c121ba71-e666-50bf-b548-6966c8feb179","subtitle":"","versionDifference":0.09999999999999987,"versionBasePath":"/v1.2-beta","sidebarContents":[{"title":null,"pages":[{"title":"Overview","sidebarTitle":"","description":"Explore Azure Key Vault to Kubernetes","path":"/v1.2-beta/"},{"title":"Why use akv2k8s?","sidebarTitle":"","description":null,"path":"/v1.2-beta/why-akv2k8s/"},{"title":"Quick Start","sidebarTitle":"","description":"Quickly get started using Azure Key Vault to Kubernetes","path":"/v1.2-beta/quick-start/"},{"title":"How it Works","sidebarTitle":"","description":"Learn about the inner workings of akv2k8s.","path":"/v1.2-beta/how-it-works/"},{"title":"FAQ","sidebarTitle":"","description":"Most frequently asked questions","path":"/v1.2-beta/faq/"}]},{"title":"Installation","pages":[{"title":"Overview","sidebarTitle":"","description":"Different options for installing akv2k8s","path":"/v1.2-beta/installation/"},{"title":"Requirements","sidebarTitle":"","description":"Requirements for installing akv2k8s","path":"/v1.2-beta/installation/requirements/"},{"title":"Installing on Azure AKS","sidebarTitle":"","description":"How to install Azure Key Vault to Kubernetes (akv2k8s) on Azure AKS","path":"/v1.2-beta/installation/on-azure-aks/"},{"title":"Installing outside Azure AKS","sidebarTitle":"","description":"Learn how to install Azure Key Vault to Kubernetes outside Azure AKS","path":"/v1.2-beta/installation/outside-azure-aks/"},{"title":"Updating akv2k8s CRDs","sidebarTitle":"","description":"How to update akv2k8s Custom Resource Definitions (CRDs)","path":"/v1.2-beta/installation/crd/"},{"title":"Installation without Helm","sidebarTitle":"","description":"How to setup Azure Key Vault to Kubernetes","path":"/v1.2-beta/installation/without-helm/"},{"title":"Upgrade","sidebarTitle":"","description":"How to upgrade Azure Key Vault to Kubernetes","path":"/v1.2-beta/installation/upgrade/"},{"title":"Add Exception for aad-pod-identity","sidebarTitle":"","description":"Learn what needs to be done to run successfully with aad-pod-identity","path":"/v1.2-beta/installation/with-aad-pod-identity/"}]},{"title":"Tutorials","pages":[{"title":"Tutorials","sidebarTitle":"","description":"A quick introduction to the tutorials","path":"/v1.2-beta/tutorials/"},{"title":"Prerequisites","sidebarTitle":"","description":"A quick overview of the prerequisites needed to complete the tutorials","path":"/v1.2-beta/tutorials/prerequisites/"},{"title":"Sync Secret","sidebarTitle":"","description":"Sync a secret from Azure Key Vault into a Kubernetes Secret","path":"/v1.2-beta/tutorials/sync/1-secret/"},{"title":"Sync Certificate","sidebarTitle":"","description":"Sync a certificate from Azure Key Vault into a Kubernetes Secret.","path":"/v1.2-beta/tutorials/sync/2-certificate/"},{"title":"Sync Signing Key","sidebarTitle":"","description":"Sync signing key from Azure Key Vault into a Kubernetes Secret","path":"/v1.2-beta/tutorials/sync/3-signing-key/"},{"title":"Sync Multi Key Value Secret","sidebarTitle":"","description":"Sync a multi-key-value secret from Azure Key Vault into a Kubernetes Secret","path":"/v1.2-beta/tutorials/sync/4-multi-key-value-secret/"},{"title":"Sync Secret to ConfigMap","sidebarTitle":"","description":"Sync a secret from Azure Key Vault into a Kubernetes ConfigMap","path":"/v1.2-beta/tutorials/sync/6-secret-to-configmap/"},{"title":"Inject Secret","sidebarTitle":"","description":"Inject an Azure Key Vault secret directly into a container application","path":"/v1.2-beta/tutorials/env-injection/1-secret/"},{"title":"Inject Certificate","sidebarTitle":"","description":"Inject an Azure Key Vault certificate key pair directly into a container application","path":"/v1.2-beta/tutorials/env-injection/2-certificate/"},{"title":"Inject Signing Key","sidebarTitle":"","description":"Inject a signing key from Azure Key Vault as environment variable into an application","path":"/v1.2-beta/tutorials/env-injection/3-signing-key/"},{"title":"Inject PFX Certificate","sidebarTitle":"","description":"Inject a PFX certificate from Azure Key Vault as environment variables into an application","path":"/v1.2-beta/tutorials/env-injection/5-pfx-certificate/"}]},{"title":"Security","pages":[{"title":"Authentication with Azure Key Vault","sidebarTitle":"","description":"Learn about the different options for authenticating with Azure Key Vault.","path":"/v1.2-beta/security/authentication/"},{"title":"Authorization","sidebarTitle":"","description":"Learn how to set the proper access rights in Azure Key Vault","path":"/v1.2-beta/security/authorization/"},{"title":"Enable Environment Injecton","sidebarTitle":"","description":"Learn how to enable environment injection per Kubernetes namespace","path":"/v1.2-beta/security/enable-env-injection/"}]},{"title":"Monitoring","pages":[{"title":"Logs","sidebarTitle":"","description":"Akv2k8s logs","path":"/v1.2-beta/monitoring/logs/"},{"title":"Metrics","sidebarTitle":"","description":"Akv2k8s metrics","path":"/v1.2-beta/monitoring/metrics/"}]},{"title":"Troubleshooting","pages":[{"title":"Get the akv2k8s Controller Log","sidebarTitle":"","description":"How to access the Controller log and specify log level","path":"/v1.2-beta/troubleshooting/controller-log/"},{"title":"Set env-injector log-level","sidebarTitle":"","description":"How to set the log-level for the env-injector","path":"/v1.2-beta/troubleshooting/env-injector-log-level/"},{"title":"Known Issues","sidebarTitle":"","description":"A list of known issues and available solutions or workarounds","path":"/v1.2-beta/troubleshooting/known-issues/"}]},{"title":"Reference","pages":[{"title":"Reference","sidebarTitle":"","description":"Reference of akv2k8s objects","path":"/v1.2-beta/reference/"},{"title":"AzureKeyVaultSecret","sidebarTitle":"","description":"Reference of AzureKeyVaultSecret custom resource definition","path":"/v1.2-beta/reference/azure-key-vault-secret/"}]}],"githubUrl":"https://github.com/sparebankenvest/akv2k8s-website/tree/v1.2.0-beta/source/content/installation/outside-azure-aks.md","spectrumUrl":"","twitterHandle":"","versions":["1.2-beta","1.0"],"defaultVersion":"1.1","baseUrl":"https://akv2k8s.io"}},"staticQueryHashes":["1511030359","2468095761","2468095761","426988268","426988268"]}